<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Results Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .chart-title {
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        canvas {
            max-height: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Test Results Visualization</h1>
        
        <!-- Key Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Average Key Generation</div>
                <div class="stat-value">749<span style="font-size: 0.5em;">ms</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Correctness Rate</div>
                <div class="stat-value">100<span style="font-size: 0.5em;">%</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Encryption Speed (100KB)</div>
                <div class="stat-value">211<span style="font-size: 0.5em;">KB/s</span></div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Multi-User Success</div>
                <div class="stat-value">100<span style="font-size: 0.5em;">%</span></div>
            </div>
        </div>

        <!-- Charts -->
        <div class="chart-grid">
            <!-- Chart 1: Key Generation Times -->
            <div class="chart-container">
                <h3 class="chart-title">RSA Key Generation Performance</h3>
                <canvas id="keyGenChart"></canvas>
            </div>

            <!-- Chart 2: Encryption Performance -->
            <div class="chart-container">
                <h3 class="chart-title">Encryption Time vs Message Size</h3>
                <canvas id="encryptChart"></canvas>
            </div>

            <!-- Chart 3: Encryption Speed -->
            <div class="chart-container">
                <h3 class="chart-title">Encryption Throughput (KB/s)</h3>
                <canvas id="speedChart"></canvas>
            </div>

            <!-- Chart 4: Encrypt vs Decrypt -->
            <div class="chart-container">
                <h3 class="chart-title">Encryption vs Decryption Time</h3>
                <canvas id="compareChart"></canvas>
            </div>

            <!-- Chart 5: Correctness Tests -->
            <div class="chart-container">
                <h3 class="chart-title">Correctness Test Results (100 iterations)</h3>
                <canvas id="correctnessChart"></canvas>
            </div>

            <!-- Chart 6: Security Tests -->
            <div class="chart-container">
                <h3 class="chart-title">Security Test Results</h3>
                <canvas id="securityChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Fetch test data from server
        async function loadTestData() {
            try {
                const response = await fetch('/latest-test-results');
                if (!response.ok) {
                    throw new Error('No test results found');
                }
                const results = await response.json();
                return convertResults(results);
            } catch (error) {
                console.error('Failed to load test results:', error);
                alert('No test results found. Please run tests first.');
                return null;
            }
        }

        function convertResults(results) {
            return {
                keyGeneration: {
                    times: results.keyGeneration.times || [],
                    avgTime: results.keyGeneration.avgTime || 0,
                    minTime: results.keyGeneration.minTime || 0,
                    maxTime: results.keyGeneration.maxTime || 0
                },
                encryption: results.encryption || [],
                decryption: results.decryption || [],
                correctness: {
                    successCount: results.correctness.successCount || 0,
                    iterations: results.correctness.iterations || 100,
                    signatureValidCount: results.correctness.signatureValidCount || 0,
                    tamperedDetectedCount: results.correctness.tamperedDetectedCount || 0
                },
                multiUser: {
                    successRate: results.multiUser?.successRate || '0',
                    successCount: results.multiUser?.successCount || 0,
                    totalTests: results.multiUser?.totalTests || 0
                },
                security: {
                    validSignature: results.security.validSignature || 0,
                    tamperedSignature: results.security.tamperedSignature || 0
                }
            };
        }

        async function initializeCharts() {
            const testData = await loadTestData();
            if (!testData) return;

            // Update stats cards
            const correctnessRate = ((testData.correctness.successCount / testData.correctness.iterations) * 100).toFixed(0);
            const multiUserRate = parseFloat(testData.multiUser.successRate).toFixed(0);
            
            document.querySelector('.stats-grid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Average Key Generation</div>
                    <div class="stat-value">${testData.keyGeneration.avgTime.toFixed(0)}<span style="font-size: 0.5em;">ms</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Correctness Rate</div>
                    <div class="stat-value">${correctnessRate}<span style="font-size: 0.5em;">%</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Encryption Speed (100KB)</div>
                    <div class="stat-value">${testData.encryption[4]?.speed.toFixed(0) || 'N/A'}<span style="font-size: 0.5em;">KB/s</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Multi-User Success</div>
                    <div class="stat-value">${multiUserRate}<span style="font-size: 0.5em;">%</span></div>
                </div>
            `;

        // Chart 1: Key Generation Times
        new Chart(document.getElementById('keyGenChart'), {
            type: 'bar',
            data: {
                labels: ['Attempt 1', 'Attempt 2', 'Attempt 3', 'Attempt 4', 'Attempt 5', 'Average'],
                datasets: [{
                    label: 'Time (ms)',
                    data: [...testData.keyGeneration.times, testData.keyGeneration.avgTime],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(118, 75, 162, 0.9)'
                    ],
                    borderColor: [
                        'rgba(102, 126, 234, 1)',
                        'rgba(102, 126, 234, 1)',
                        'rgba(102, 126, 234, 1)',
                        'rgba(102, 126, 234, 1)',
                        'rgba(102, 126, 234, 1)',
                        'rgba(118, 75, 162, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Time (ms)' }
                    }
                }
            }
        });

        // Chart 2: Encryption Time vs Message Size
        new Chart(document.getElementById('encryptChart'), {
            type: 'line',
            data: {
                labels: ['16 B', '128 B', '1 KB', '10 KB', '100 KB'],
                datasets: [{
                    label: 'Encryption Time (ms)',
                    data: testData.encryption.map(e => e.avgTime || e.time),
                    borderColor: 'rgba(102, 126, 234, 1)',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true,
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Time (ms)' }
                    }
                }
            }
        });

        // Chart 3: Encryption Speed
        new Chart(document.getElementById('speedChart'), {
            type: 'bar',
            data: {
                labels: ['16 B', '128 B', '1 KB', '10 KB', '100 KB'],
                datasets: [{
                    label: 'Throughput (KB/s)',
                    data: testData.encryption.map(e => e.speed),
                    backgroundColor: 'rgba(17, 153, 142, 0.7)',
                    borderColor: 'rgba(17, 153, 142, 1)',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Speed (KB/s)' }
                    }
                }
            }
        });

        // Chart 4: Encryption vs Decryption
        new Chart(document.getElementById('compareChart'), {
            type: 'bar',
            data: {
                labels: ['16 B', '128 B', '1 KB', '10 KB'],
                datasets: [
                    {
                        label: 'Encryption Time',
                        data: testData.decryption.map(d => d.avgEncTime || d.encryptTime),
                        backgroundColor: 'rgba(102, 126, 234, 0.7)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2
                    },
                    {
                        label: 'Decryption Time',
                        data: testData.decryption.map(d => d.avgDecTime || d.decryptTime),
                        backgroundColor: 'rgba(242, 153, 74, 0.7)',
                        borderColor: 'rgba(242, 153, 74, 1)',
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Time (ms)' }
                    }
                }
            }
        });

        // Chart 5: Correctness Results
        const failedCount = testData.correctness.iterations - testData.correctness.successCount;
        const correctnessPercent = ((testData.correctness.successCount / testData.correctness.iterations) * 100).toFixed(2);
        
        new Chart(document.getElementById('correctnessChart'), {
            type: 'doughnut',
            data: {
                labels: ['Successful', 'Failed'],
                datasets: [{
                    data: [testData.correctness.successCount, failedCount],
                    backgroundColor: [
                        'rgba(56, 239, 125, 0.8)',
                        'rgba(220, 53, 69, 0.8)'
                    ],
                    borderColor: [
                        'rgba(56, 239, 125, 1)',
                        'rgba(220, 53, 69, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    title: {
                        display: true,
                        text: `${correctnessPercent}% Success Rate (${testData.correctness.successCount}/${testData.correctness.iterations})`
                    }
                }
            }
        });

        // Chart 6: Security Tests
        new Chart(document.getElementById('securityChart'), {
            type: 'bar',
            data: {
                labels: ['Valid Signatures\nAccepted', 'Tampered Signatures\nRejected'],
                datasets: [{
                    label: 'Tests Passed',
                    data: [testData.security.validSignature, testData.security.tamperedSignature],
                    backgroundColor: [
                        'rgba(56, 239, 125, 0.7)',
                        'rgba(242, 153, 74, 0.7)'
                    ],
                    borderColor: [
                        'rgba(56, 239, 125, 1)',
                        'rgba(242, 153, 74, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 10,
                        title: { display: true, text: 'Number of Tests' }
                    }
                }
            }
        });
        }

        // Initialize charts when page loads
        initializeCharts();
    </script>
</body>
</html>
